providers = ["node"]

[phases.setup]
nixPkgs = ["nodejs_20", "python3", "gcc", "gnumake"]

[phases.install]
# Use different cache directory to avoid mounted cache conflicts
cmds = ["npm install --force --cache=/tmp/.npm --production=false"]

[phases.build]
# Build with memory limit
cmds = ["NODE_OPTIONS='--max-old-space-size=4096' npm run build"]

[start]
cmd = "npm start"

[variables]
# Optimize for Railway build environment
NIXPACKS_NO_CACHE = "false"
# Prevent transformers.js from downloading models during build
TRANSFORMERS_CACHE = "/tmp/transformers-cache"

[caches]
# Disable caching to avoid mount conflicts
paths = []