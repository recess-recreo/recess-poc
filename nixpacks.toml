[providers]
node = true

[phases.setup]
nixPkgs = ["nodejs_20", "npm-10_x", "python3", "gcc", "gnumake"]

[phases.install]
cmds = ["npm ci --production=false"]

[phases.build]
cmds = ["NODE_OPTIONS='--max-old-space-size=4096' npm run build"]

[start]
cmd = "npm start"

[variables]
# Optimize for Railway build environment
NIXPACKS_NO_CACHE = "false"
# Prevent transformers.js from downloading models during build
TRANSFORMERS_CACHE = "/tmp/transformers-cache"