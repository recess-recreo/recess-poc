# Manual Railway Deployment Guide

This guide provides step-by-step instructions for deploying the POC project to Railway when automated CLI authentication is not possible.

## Authentication Issue

The Railway CLI requires interactive browser authentication via `railway login`, which cannot be performed in automated environments. The token `0c859978-f37c-4559-b930-0178f2e48b01` from your .env.local file appears to be a project ID rather than an authentication token.

## Manual Deployment Steps

### Prerequisites
- Railway CLI installed (`railway --version` shows 4.5.5)
- Access to a browser for authentication
- Project token/ID: `0c859978-f37c-4559-b930-0178f2e48b01`

### Step 1: Authenticate with Railway
```bash
railway login
```
This will open a browser window for authentication.

### Step 2: Link to Your Project
```bash
# Use the project ID from your .env.local file
railway link --project "0c859978-f37c-4559-b930-0178f2e48b01"
```

### Step 3: Verify Project Status
```bash
railway status
```

### Step 4: Add Required Services

#### Add PostgreSQL:
```bash
railway add postgresql
```

#### Add Redis:
```bash
railway add redis
```

### Step 5: Set Environment Variables

Based on your .env.local file, set these variables:

```bash
# Production environment
railway variables set NODE_ENV="production"

# Session configuration (secure secret for production)
railway variables set SESSION_SECRET="sIDROVjRzCQ5HBhOGQ5Fl9k6YqKmZ7VEVG8G/wCMpBw="

# API Keys
railway variables set OPENROUTER_API_KEY="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"

# Demo configuration  
railway variables set DEMO_PASSWORD="recess2024"

# Site URL (update this after getting your deployment URL)
railway variables set SITE_URL="https://your-app-name.up.railway.app"
```

### Step 6: Deploy the Application
```bash
railway up
```

Or for background deployment:
```bash
railway up --detach
```

### Step 7: Get Deployment Information
```bash
# Check deployment status
railway status

# Get your deployment URL
railway domain
```

### Step 8: Post-Deployment Configuration

1. **Update SITE_URL**: Once you have your deployment URL, update it:
```bash
railway variables set SITE_URL="https://your-actual-deployment-url.up.railway.app"
```

2. **Test the Application**:
   - Visit your Railway URL
   - Login with password: `recess2024`
   - Navigate to `/demo/poc1` to test the POC functionality

## Environment Variables Summary

Here are all the environment variables configured for production:

| Variable | Value | Source |
|----------|--------|---------|
| NODE_ENV | production | Set for Railway |
| SESSION_SECRET | sIDROVjRzCQ5HBhOGQ5Fl9k6YqKmZ7VEVG8G/wCMpBw= | Generated secure key |
| OPENROUTER_API_KEY | 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 | From .env.local |
| DEMO_PASSWORD | recess2024 | From .env.local |
| SITE_URL | (Your Railway URL) | Set after deployment |
| DATABASE_URL | (Auto-generated by Railway PostgreSQL) | Railway service |
| REDIS_URL | (Auto-generated by Railway Redis) | Railway service |

## Railway Configuration

Your project includes a `railway.json` file with optimized settings:

- **Builder**: NIXPACKS (automatic detection)
- **Build Command**: `npm run build`
- **Start Command**: `npm start`
- **Health Check**: `/` with 300s timeout
- **Restart Policy**: ON_FAILURE with max 10 retries

## Troubleshooting

### Common Issues:

1. **Authentication Problems**: Ensure `railway login` was successful
2. **Project Linking**: If linking fails, verify the project ID
3. **Build Failures**: Check logs with `railway logs`
4. **Environment Variables**: Verify all required vars are set with `railway variables`

### Useful Commands:

```bash
# View logs
railway logs

# Redeploy
railway redeploy

# Check environment variables
railway variables

# View project info
railway status
```

## Security Notes

- The production SESSION_SECRET is different from the local development one
- API keys are properly configured for production use
- Database and Redis URLs are auto-generated by Railway services
- The DEMO_PASSWORD remains the same for consistency

## Expected Behavior

After successful deployment:

1. **Root URL**: Shows login form
2. **Authentication**: Use password "recess2024"
3. **Demo Interface**: Available at `/demo/poc1` after login
4. **API Endpoints**: Available at `/api/v1/*` for AI functionality

---

*This guide was generated based on the project configuration and environment variables found in .env.local*